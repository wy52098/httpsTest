@Service
public class EmpOTService {

    @Autowired
    private EmpOTMapper empOTMapper;

    public List<DeptAndEmp> listTree() {
        // 1.???? ???
        List<DeptAndEmp> deptAndEmps =   empOTMapper.findParent();

        for (DeptAndEmp deptAndEmp : deptAndEmps) {
            // 2. ??????
            List<DeptAndEmp> childDandEs =  empOTMapper.findChildren(deptAndEmp.getOrgCode());
            // ??????
            for (DeptAndEmp childDandE : childDandEs) {
                // ??????????????? ?? ????2???????
                childDandE.setDeptAndEmps(findChild(childDandE.getOrgCode()));
                // ???????????????????(??)?????????????? ???
                List<DeptAndEmp> emps = empOTMapper.findLeader(childDandE.getOrgCode());
                // ???????? ? ??????????
                if(emps.size()>0 && emps != null && childDandE.getDeptAndEmps() != null){
                    // ????????,????? ?
                for (DeptAndEmp emp : emps) {
                        // get??????getDeptAndEmps()??null,???????????
                        childDandE.getDeptAndEmps().add(emp);
                    }
                }
                // ??????????? ????????????
                if(childDandE.getDeptAndEmps() == null)
                    childDandE.setDeptAndEmps(emps);

            }
            // ??????????? ??????????
            deptAndEmp.setDeptAndEmps(childDandEs);
        }

        return deptAndEmps;
    }

    /**
     * ????????
     * @param orgCode ???????
     * @return
     */
    private List<DeptAndEmp> findChild(String orgCode) {
        // deptAndEmps ????
        List<DeptAndEmp> deptAndEmps = empOTMapper.findChildren(orgCode);
        // ????:??????????? ???????????????
        if(deptAndEmps == null || deptAndEmps.size() <= 0){
            return null;
        }
        // ?????
        for (DeptAndEmp deptAndEmp : deptAndEmps) {
            // ?????????????
            deptAndEmp.setDeptAndEmps(findChild(deptAndEmp.getOrgCode()));
            // ??????????????
            List<DeptAndEmp> emps = empOTMapper.findLeader(deptAndEmp.getOrgCode());
            // ??????? ,?????????
            if(emps != null && emps.size()>0 && deptAndEmp.getDeptAndEmps() != null){
                for (DeptAndEmp emp : emps) {
                        deptAndEmp.getDeptAndEmps().add(emp);
                }
            }
            // ???????
            if(deptAndEmp.getDeptAndEmps() == null)
            // ??????
            deptAndEmp.setDeptAndEmps(emps);

        }
        //???????
        return deptAndEmps;
    }
}
